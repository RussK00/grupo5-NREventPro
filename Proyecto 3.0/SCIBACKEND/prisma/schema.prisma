// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. Modelo de Usuario (ya lo tenías)
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  nombre    String
  password  String
  rol       String   // "CLIENTE", "ORGANIZADOR", "PERSONAL_INGRESO"
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relaciones
  eventosOrganizados Event[]     @relation("OrganizadorEventos")
  compras            Purchase[]  @relation("ClienteCompras")
}

// 2. Modelo de Evento (NUEVO)
model Event {
  id          Int      @id @default(autoincrement())
  nombre      String
  fecha       DateTime
  lugar       String
  descripcion String
  bannerUrl   String?   // Opcional

  // Relación con Organizador (User)
  organizadorId Int
  organizador   User     @relation("OrganizadorEventos", fields: [organizadorId], references: [id])
  
  // Relación con Tipos de Entrada
  tiposDeEntrada TicketType[]

  // Relación con Entradas (Tickets)
  tickets Ticket[]
}

// 3. Modelo de Tipos de Entrada (NUEVO)
// (Tu "TipoDeEntrada" del UML)
model TicketType {
  id     Int    @id @default(autoincrement())
  nombre String // "General", "VIP"
  precio Float
  cupo   Int    // Aforo para este tipo de entrada

  // Relación con Evento
  eventoId Int
  evento   Event  @relation(fields: [eventoId], references: [id])
  
  // Relación con Entradas (Tickets)
  tickets Ticket[]
}

// 4. Modelo de Compra (NUEVO)
// (Tu "Compra" del UML)
model Purchase {
  id        Int      @id @default(autoincrement())
  fecha     DateTime @default(now())
  total     Float

  // Relación con Cliente (User)
  clienteId Int
  cliente   User     @relation("ClienteCompras", fields: [clienteId], references: [id])

  // Relación con Entradas (Tickets)
  tickets   Ticket[]
}

// 5. Modelo de Entrada/Ticket (NUEVO)
// (Tu "Entrada" del UML)
model Ticket {
  id     Int     @id @default(autoincrement())
  qrCode String  @unique @default(uuid()) // Genera un QR único
  status String  @default("VALIDO")     // "VALIDO", "USADO"

  // Relación con la Compra
  purchaseId Int
  purchase   Purchase @relation(fields: [purchaseId], references: [id])

  // Relación con el Evento
  eventoId Int
  evento   Event  @relation(fields: [eventoId], references: [id])

  // Relación con el Tipo de Entrada
  ticketTypeId Int
  ticketType   TicketType @relation(fields: [ticketTypeId], references: [id])
}